{% extends "admin/base.html" %}

{% block title %}Dashboard{% endblock %}
{% block breadcrumb %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}

<!-- Stats Grid -->
<div class="stats-grid">

  <a href="/admin/users" class="stat-card">
    <div class="stat-icon brand">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
    </div>
    <div class="stat-info">
      <span class="stat-label">Total Users</span>
      <span class="stat-value">{{ user_count }}</span>
    </div>
  </a>

  <a href="/admin/labs" class="stat-card">
    <div class="stat-icon green">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2v-4M9 21H5a2 2 0 0 1-2-2v-4m0 0h18"/></svg>
    </div>
    <div class="stat-info">
      <span class="stat-label">Labs</span>
      <span class="stat-value">{{ lab_count }}</span>
    </div>
  </a>

  <a href="/admin/levels" class="stat-card">
    <div class="stat-icon yellow">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>
    </div>
    <div class="stat-info">
      <span class="stat-label">Levels</span>
      <span class="stat-value">{{ level_count }}</span>
    </div>
  </a>

  <a href="/admin/submissions" class="stat-card">
    <div class="stat-icon blue">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
    </div>
    <div class="stat-info">
      <span class="stat-label">Submissions</span>
      <span class="stat-value">{{ submission_count }}</span>
    </div>
  </a>

  <a href="/admin/badges" class="stat-card">
    <div class="stat-icon violet">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>
    </div>
    <div class="stat-info">
      <span class="stat-label">Badges</span>
      <span class="stat-value">{{ badge_count }}</span>
    </div>
  </a>

</div>

<!-- Recent Submissions -->
<div class="card">
  <div class="card-head">
    <div class="card-title">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      Recent Submissions
    </div>
    <a href="/admin/submissions" class="btn btn-ghost btn-sm">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="width:12px;height:12px;"><polyline points="9 18 15 12 9 6"/></svg>
      View All
    </a>
  </div>
  <div class="card-body">
    {% if recent_submissions %}
    <div class="mini-activity">
      {% for sub in recent_submissions %}
      <div class="activity-row">
        <div class="activity-avatar">
          {{ sub.user.username[0].upper() if sub.user and sub.user.username else '?' }}
        </div>
        <div class="activity-info">
          <div class="activity-main">
            {{ sub.user.username if sub.user else 'Unknown' }}
            <span style="color:var(--text-3); font-weight:400;">submitted to</span>
            Level {{ sub.level_id }}
          </div>
          <div class="activity-sub">Status:
            <span class="badge {% if sub.status == 'Passed' %}badge-success{% elif sub.status == 'Failed' %}badge-danger{% else %}badge-warning{% endif %}">
              {{ sub.status }}
            </span>
          </div>
        </div>
        <span class="activity-time">
          {{ sub.timestamp.strftime('%d %b, %H:%M') if sub.timestamp else 'â€”' }}
        </span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div style="text-align:center; padding:40px 0; color:var(--text-3);">
      <svg xmlns="http://www.w3.org/2000/svg" style="width:40px;height:40px;margin:0 auto 10px;display:block;stroke-width:1;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      <p style="font-size:0.84rem;">No submissions yet. Users haven't started playing!</p>
    </div>
    {% endif %}
  </div>
</div>

<!-- Quick Links -->
<div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px;">

  <a href="/admin/labs/new" class="card" style="padding:18px 20px; display:flex; align-items:center; gap:14px; text-decoration:none; transition:all 0.16s;">
    <div class="stat-icon green" style="width:38px;height:38px;">
      <svg xmlns="http://www.w3.org/2000/svg" style="width:18px;height:18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </div>
    <div>
      <div style="font-size:0.84rem;font-weight:700;color:var(--text-1);">New Lab</div>
      <div style="font-size:0.72rem;color:var(--text-3);">Create a coding lab</div>
    </div>
  </a>

  <a href="/admin/levels/new" class="card" style="padding:18px 20px; display:flex; align-items:center; gap:14px; text-decoration:none; transition:all 0.16s;">
    <div class="stat-icon yellow" style="width:38px;height:38px;">
      <svg xmlns="http://www.w3.org/2000/svg" style="width:18px;height:18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </div>
    <div>
      <div style="font-size:0.84rem;font-weight:700;color:var(--text-1);">New Level</div>
      <div style="font-size:0.72rem;color:var(--text-3);">Add a challenge level</div>
    </div>
  </a>

  <a href="/admin/badges/new" class="card" style="padding:18px 20px; display:flex; align-items:center; gap:14px; text-decoration:none; transition:all 0.16s;">
    <div class="stat-icon violet" style="width:38px;height:38px;">
      <svg xmlns="http://www.w3.org/2000/svg" style="width:18px;height:18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </div>
    <div>
      <div style="font-size:0.84rem;font-weight:700;color:var(--text-1);">New Badge</div>
      <div style="font-size:0.72rem;color:var(--text-3);">Create an achievement</div>
    </div>
  </a>

</div>

{% endblock %}
