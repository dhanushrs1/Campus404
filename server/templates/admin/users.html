{% extends "admin/base.html" %}

{% block title %}Users{% endblock %}
{% block breadcrumb %}Users{% endblock %}
{% block page_title %}Users{% endblock %}

{% block header_actions %}
  <span class="badge badge-muted">{{ users | length }} total</span>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-head">
    <div class="card-title">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      All Users
    </div>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Username</th>
          <th>Total XP</th>
          <th>Role</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if users %}
          {% for user in users %}
          <tr>
            <td class="mono">{{ user.id }}</td>
            <td>
              <div style="display:flex;align-items:center;gap:10px;">
                <div style="width:30px;height:30px;background:var(--brand-soft);border:1px solid var(--brand-border);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:0.72rem;font-weight:800;color:var(--brand-light);font-family:var(--font-mono);flex-shrink:0;">
                  {{ user.username[0].upper() if user.username else '?' }}
                </div>
                <span style="font-weight:600;">{{ user.username or '—' }}</span>
              </div>
            </td>
            <td>
              <span style="font-family:var(--font-mono);font-size:0.82rem;color:var(--warning);font-weight:600;">
                ⚡ {{ user.total_xp or 0 }}
              </span>
            </td>
            <td>
              {% if user.is_admin %}
                <span class="badge badge-brand">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                  Admin
                </span>
              {% else %}
                <span class="badge badge-muted">User</span>
              {% endif %}
            </td>
            <td>
              {% if user.is_banned %}
                <span class="badge badge-danger">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
                  Banned
                </span>
              {% else %}
                <span class="badge badge-success">Active</span>
              {% endif %}
            </td>
            <td>
              <div class="table-actions">
                <form method="post" action="/admin/users/{{ user.id }}/toggle-admin" style="display:inline;">
                  <button type="submit" class="btn btn-sm {% if user.is_admin %}btn-warning-soft{% else %}btn-ghost{% endif %}" title="{{ 'Remove Admin' if user.is_admin else 'Make Admin' }}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    {{ 'Demote' if user.is_admin else 'Admin' }}
                  </button>
                </form>
                <form method="post" action="/admin/users/{{ user.id }}/toggle-ban" style="display:inline;">
                  <button type="submit" class="btn btn-sm {% if user.is_banned %}btn-success-soft{% else %}btn-danger-soft{% endif %}" title="{{ 'Unban' if user.is_banned else 'Ban' }}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                      {% if user.is_banned %}<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                      {% else %}<circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>{% endif %}
                    </svg>
                    {{ 'Unban' if user.is_banned else 'Ban' }}
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr class="empty-row">
            <td colspan="6">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
              No users registered yet.
              <p>Users will appear here once they sign up on the platform.</p>
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
