{% extends "admin/base.html" %}

{% block title %}Submissions{% endblock %}
{% block breadcrumb %}Submissions{% endblock %}
{% block page_title %}Submissions{% endblock %}

{% block header_actions %}
  <span class="badge badge-muted">{{ submissions | length }} total</span>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-head">
    <div class="card-title">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      All Submissions
    </div>
    <span class="badge badge-info">Read-Only</span>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>User</th>
          <th>Level</th>
          <th>Status</th>
          <th>Submitted Code</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody>
        {% if submissions %}
          {% for sub in submissions %}
          <tr>
            <td class="mono">{{ sub.id }}</td>
            <td>
              <div style="display:flex;align-items:center;gap:8px;">
                <div style="width:26px;height:26px;background:var(--brand-soft);border:1px solid var(--brand-border);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.68rem;font-weight:800;color:var(--brand-light);font-family:var(--font-mono);flex-shrink:0;">
                  {{ sub.user.username[0].upper() if sub.user and sub.user.username else '?' }}
                </div>
                <span style="font-weight:600;font-size:0.84rem;">
                  {{ sub.user.username if sub.user else 'User #' ~ sub.user_id }}
                </span>
              </div>
            </td>
            <td>
              <span class="badge badge-info">Level {{ sub.level_id }}</span>
            </td>
            <td>
              {% if sub.status == 'Passed' %}
                <span class="badge badge-success">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                  Passed
                </span>
              {% elif sub.status == 'Failed' %}
                <span class="badge badge-danger">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                  Failed
                </span>
              {% else %}
                <span class="badge badge-warning">{{ sub.status or 'Unknown' }}</span>
              {% endif %}
            </td>
            <td style="max-width:240px;">
              <code style="font-size:0.72rem;color:var(--text-2);background:var(--bg-surface);padding:4px 8px;border-radius:4px;display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                {{ sub.submitted_code[:80] ~ '…' if sub.submitted_code and sub.submitted_code|length > 80 else (sub.submitted_code or '—') }}
              </code>
            </td>
            <td class="mono" style="font-size:0.75rem;color:var(--text-3);white-space:nowrap;">
              {{ sub.timestamp.strftime('%d %b %Y, %H:%M') if sub.timestamp else '—' }}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr class="empty-row">
            <td colspan="6">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
              No submissions yet.
              <p>Submissions will appear here when users attempt levels.</p>
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
